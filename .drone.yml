---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm i --no-optional

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - npm i --production --no-optional

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: WPsq04T2v5bbdCGirHSM9ZcWVAR3aSJytpWj3HmnX3OLvakka8+TpRPykFlDZLjHBu5neoVR8RJ92fb2FpAQlQ==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 18e8610cccb8272fb99bd4c196b38e9767dda23e1d2ee15726d11d6089274c12

...
